"use strict";(globalThis.webpackChunkknowledge_bank=globalThis.webpackChunkknowledge_bank||[]).push([[8652],{2581(r,n,e){e.r(n),e.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"frontend/react/archive/redux/classic","title":"Redux-classic","description":"yarn add redux react-redux redux-thunk @types/react-redux redux-devtools-extension","source":"@site/docs/3 - frontend/5 - react/88-archive/2-redux/5-classic.md","sourceDirName":"3 - frontend/5 - react/88-archive/2-redux","slug":"/frontend/react/archive/redux/classic","permalink":"/knowledge-bank/docs/frontend/react/archive/redux/classic","draft":false,"unlisted":false,"editUrl":"https://github.com/EvgenyLeukhin/knowledge-bank/edit/main/docs/3 - frontend/5 - react/88-archive/2-redux/5-classic.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Redux-classic","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"\u041f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435","permalink":"/knowledge-bank/docs/frontend/react/archive/redux/usage"},"next":{"title":"fetch","permalink":"/knowledge-bank/docs/frontend/react/archive/api/fetch"}}');var s=e(4848),o=e(8453);const a={title:"Redux-classic",sidebar_position:5},i=void 0,c={},p=[{value:"store/index.ts",id:"storeindexts",level:3},{value:"store/rootReducer.ts",id:"storerootreducerts",level:3},{value:"store/actions.ts",id:"storeactionsts",level:3},{value:"store/app/app.reducer.ts",id:"storeappappreducerts",level:3},{value:"store/app/app.types.ts",id:"storeappapptypests",level:3},{value:"store/app/app.actionCreators.ts",id:"storeappappactioncreatorsts",level:3},{value:"store/login/login.reducer.ts",id:"storeloginloginreducerts",level:3},{value:"store/login/login.types.ts",id:"storeloginlogintypests",level:3},{value:"store/login/login.actionCreators.ts",id:"storeloginloginactioncreatorsts",level:3},{value:"httpClient",id:"httpclient",level:3},{value:"../loginService",id:"loginservice",level:3},{value:"How to use inside component",id:"how-to-use-inside-component",level:3}];function l(r){const n={code:"code",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...r.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"yarn add redux react-redux redux-thunk @types/react-redux redux-devtools-extension"})}),"\n",(0,s.jsx)(n.h3,{id:"storeindexts",children:"store/index.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { applyMiddleware, legacy_createStore } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport { RootState, rootReducer } from './rootReducer';\r\nimport { TypedUseSelectorHook, useSelector } from 'react-redux';\r\nimport { composeWithDevTools } from 'redux-devtools-extension';\r\n\r\nexport const testStore = legacy_createStore(\r\n  rootReducer,\r\n  composeWithDevTools(applyMiddleware(thunk)),\r\n);\r\n\r\n// \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u0445\u0443\u043a\u0430, \u0442\u0438\u043f\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0435\u043b\u0435\u043a\u0442\u043e\u0440\u0430 \u0432\u0441\u0435\u0433\u043e \u0441\u0442\u0435\u0439\u0442\u0430 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\r\nexport const useTypedSelector: TypedUseSelectorHook<RootState> = useSelector;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storerootreducerts",children:"store/rootReducer.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { combineReducers } from 'redux';\r\n\r\n// reducers list\r\nimport { appReducer } from './app/app.reducer';\r\nimport { loginReducer } from './login/login.reducer';\r\n\r\nexport const rootReducer = combineReducers({\r\n  app: appReducer,\r\n  login: loginReducer,\r\n});\r\n\r\n// \u0438\u043c\u043f\u043e\u0440\u0442 \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u0438 \u0432\u0441\u0435\u0433\u043e state\r\nexport type RootState = ReturnType<typeof rootReducer>;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeactionsts",children:"store/actions.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { useDispatch } from 'react-redux';\r\nimport * as appActionCreators from './app/app.actionCreators';\r\nimport * as loginActionCreators from './login/login.actionCreators';\r\nimport { bindActionCreators } from 'redux';\r\n// import * as loginActionCreators from './login/login.actionCreators';\r\n\r\n// \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u0445\u0443\u043a\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0432\u0441\u0435 \u044d\u043a\u0448\u0435\u043d\u044b \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f\r\nexport const useActions = () => {\r\n  const dispatch = useDispatch();\r\n\r\n  return bindActionCreators(\r\n    {\r\n      ...appActionCreators,\r\n      ...loginActionCreators,\r\n    },\r\n    dispatch,\r\n  );\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeappappreducerts",children:"store/app/app.reducer.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import {\r\n  TAppState,\r\n  TAppActions,\r\n  AppActionTypes,\r\n  AppScreens,\r\n} from './app.types';\r\n\r\nconst appInitialState: TAppState = {\r\n  screen: AppScreens.LOGIN,\r\n  alertMessage: {\r\n    message: '',\r\n    status: undefined,\r\n  },\r\n  userData: {\r\n    token: undefined,\r\n    expiresIn: undefined,\r\n  },\r\n};\r\n\r\nexport const appReducer = (\r\n  state: TAppState = appInitialState,\r\n  action: TAppActions,\r\n): TAppState => {\r\n  switch (action.type) {\r\n    // SET_SCREEN\r\n    case AppActionTypes.SET_SCREEN:\r\n      return { ...state, screen: action.payload };\r\n\r\n    // SAVE_USER_DATA\r\n    case AppActionTypes.SAVE_USER_DATA:\r\n      return { ...state, userData: action.payload };\r\n\r\n    // SET_ALERT_MESSAGE\r\n    case AppActionTypes.SET_ALERT_MESSAGE:\r\n      return { ...state, alertMessage: action.payload };\r\n\r\n    // DELETE_ALERT_MESSAGE\r\n    case AppActionTypes.DELETE_ALERT_MESSAGE:\r\n      return {\r\n        ...state,\r\n        alertMessage: {\r\n          message: '',\r\n          status: undefined,\r\n        },\r\n      };\r\n\r\n    // DEFAULT\r\n    default:\r\n      return state;\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeappapptypests",children:"store/app/app.types.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { Statuses } from '@/types/common';\r\n\r\n// screens enum\r\nexport enum AppScreens {\r\n  LOGIN = 'LOGIN',\r\n  DASHBOARD = 'DASHBOARD',\r\n  EDIT_DRUGSTORE = 'EDIT_DRUGSTORE',\r\n  EDIT_MULTI_DRUGSTORE = 'EDIT_MULTI_DRUGSTORE',\r\n  CUSTOM_STATUSES = 'CUSTOM_STATUSES',\r\n}\r\n\r\n// action types enum\r\nexport enum AppActionTypes {\r\n  SET_SCREEN = 'SET_SCREEN',\r\n  SAVE_USER_DATA = 'SAVE_USER_DATA',\r\n  SET_ALERT_MESSAGE = 'SET_ALERT_MESSAGE',\r\n  DELETE_ALERT_MESSAGE = 'DELETE_ALERT_MESSAGE',\r\n}\r\n\r\nexport type TUserData = {\r\n  token?: string;\r\n  expiresIn?: number;\r\n};\r\n\r\nexport type TAlertMessage = {\r\n  message: string;\r\n  status?: Statuses;\r\n};\r\n\r\n// \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u044f \u0441\u0442\u0435\u0439\u0442\u0430\r\nexport type TAppState = {\r\n  screen: AppScreens;\r\n  alertMessage: TAlertMessage;\r\n  userData: TUserData;\r\n};\r\n\r\n// \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u044f \u044d\u043a\u0448\u0435\u043d\u043e\u0432\r\nexport type TSetScreenAction = {\r\n  type: AppActionTypes.SET_SCREEN;\r\n  payload: AppScreens;\r\n};\r\n\r\nexport type TSaveUserDataAction = {\r\n  type: AppActionTypes.SAVE_USER_DATA;\r\n  payload: TUserData;\r\n};\r\n\r\nexport type TSetAlertMessageAction = {\r\n  type: AppActionTypes.SET_ALERT_MESSAGE;\r\n  payload: TAlertMessage;\r\n};\r\n\r\nexport type TDeleteAlertMessageAction = {\r\n  type: AppActionTypes.DELETE_ALERT_MESSAGE;\r\n};\r\n\r\n// \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u0432\u0441\u0435\u0445 \u0442\u0438\u043f\u043e\u0432 \u044d\u043a\u0448\u0435\u043d\u043e\u0432\r\nexport type TAppActions =\r\n  | TSetScreenAction\r\n  | TSaveUserDataAction\r\n  | TSetAlertMessageAction\r\n  | TDeleteAlertMessageAction;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeappappactioncreatorsts",children:"store/app/app.actionCreators.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import {\r\n  AppActionTypes,\r\n  AppScreens,\r\n  TAlertMessage,\r\n  TDeleteAlertMessageAction,\r\n  TSaveUserDataAction,\r\n  TSetAlertMessageAction,\r\n  TSetScreenAction,\r\n  TUserData,\r\n} from './app.types';\r\n\r\n// setScreen\r\nexport const setScreen = (payload: AppScreens): TSetScreenAction => ({\r\n  type: AppActionTypes.SET_SCREEN,\r\n  payload,\r\n});\r\n\r\n// saveUserData\r\nexport const saveUserData = (payload: TUserData): TSaveUserDataAction => ({\r\n  type: AppActionTypes.SAVE_USER_DATA,\r\n  payload,\r\n});\r\n\r\n// setAlertMessage\r\nexport const setAlertMessage = (\r\n  payload: TAlertMessage,\r\n): TSetAlertMessageAction => ({\r\n  type: AppActionTypes.SET_ALERT_MESSAGE,\r\n  payload,\r\n});\r\n\r\n// deleteAlertMessage\r\nexport const deleteAlertMessage = (): TDeleteAlertMessageAction => ({\r\n  type: AppActionTypes.DELETE_ALERT_MESSAGE,\r\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeloginloginreducerts",children:"store/login/login.reducer.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { TLoginState, TLoginActions, LoginActionTypes } from './login.types';\r\n\r\nconst loginInitialState: TLoginState = {\r\n  isLoginLoading: false,\r\n  isLoginSuccess: false,\r\n  isLoginError: false,\r\n};\r\n\r\nexport const loginReducer = (\r\n  state: TLoginState = loginInitialState,\r\n  action: TLoginActions,\r\n): TLoginState => {\r\n  switch (action.type) {\r\n    // LOGIN_LOADING\r\n    case LoginActionTypes.LOGIN_LOADING:\r\n      return { ...state, isLoginLoading: action.payload };\r\n\r\n    // LOGIN_SUCCESS\r\n    case LoginActionTypes.LOGIN_SUCCESS:\r\n      return { ...state, isLoginSuccess: true };\r\n\r\n    // LOGIN_ERROR\r\n    case LoginActionTypes.LOGIN_ERROR:\r\n      return { ...state, isLoginError: true };\r\n\r\n    // LOGIN_RESET\r\n    case LoginActionTypes.LOGIN_RESET:\r\n      return loginInitialState;\r\n\r\n    // DEFAULT\r\n    default:\r\n      return state;\r\n  }\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeloginlogintypests",children:"store/login/login.types.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// action types enum\r\nexport enum LoginActionTypes {\r\n  LOGIN_LOADING = 'LOGIN_LOADING',\r\n  LOGIN_SUCCESS = 'LOGIN_SUCCESS',\r\n  LOGIN_ERROR = 'LOGIN_ERROR',\r\n  LOGIN_RESET = 'LOGIN_RESET',\r\n}\r\n\r\n// \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u044f \u0441\u0442\u0435\u0439\u0442\u0430\r\nexport type TLoginState = {\r\n  isLoginLoading: boolean;\r\n  isLoginSuccess: boolean;\r\n  isLoginError: boolean;\r\n};\r\n\r\n// \u0442\u0438\u043f\u0438\u0437\u0430\u0446\u0438\u044f \u044d\u043a\u0448\u0435\u043d\u043e\u0432\r\nexport type TLoginLoadingAction = {\r\n  type: LoginActionTypes.LOGIN_LOADING;\r\n  payload: boolean;\r\n};\r\n\r\nexport type TLoginSuccessAction = {\r\n  type: LoginActionTypes.LOGIN_SUCCESS;\r\n};\r\n\r\nexport type TLoginErrorAction = {\r\n  type: LoginActionTypes.LOGIN_ERROR;\r\n};\r\n\r\nexport type TLoginResetAction = {\r\n  type: LoginActionTypes.LOGIN_RESET;\r\n};\r\n\r\n// \u044d\u043a\u0441\u043f\u043e\u0440\u0442 \u0432\u0441\u0435\u0445 \u0442\u0438\u043f\u043e\u0432 \u044d\u043a\u0448\u0435\u043d\u043e\u0432\r\nexport type TLoginActions =\r\n  | TLoginLoadingAction\r\n  | TLoginSuccessAction\r\n  | TLoginErrorAction\r\n  | TLoginResetAction;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storeloginloginactioncreatorsts",children:"store/login/login.actionCreators.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import Cookies from 'js-cookie';\r\nimport { Dispatch } from 'redux';\r\n\r\nimport {\r\n  LoginActionTypes,\r\n  TLoginActions,\r\n  TLoginErrorAction,\r\n  TLoginLoadingAction,\r\n  TLoginResetAction,\r\n  TLoginSuccessAction,\r\n} from './login.types';\r\nimport {\r\n  TLoginValues,\r\n  loginService,\r\n  // loginService2,\r\n} from '../../api/services/login-sevice';\r\nimport {\r\n  saveUserData,\r\n  setAlertMessage,\r\n  setScreen,\r\n} from '../app/app.actionCreators';\r\nimport {\r\n  AppScreens,\r\n  TSaveUserDataAction,\r\n  TSetAlertMessageAction,\r\n  TSetScreenAction,\r\n} from '../app/app.types';\r\nimport { Statuses } from '@/types/common';\r\n\r\n// loginLoading\r\nexport const loginLoading = (payload: boolean): TLoginLoadingAction => ({\r\n  type: LoginActionTypes.LOGIN_LOADING,\r\n  payload,\r\n});\r\n\r\n// loginSuccess\r\nexport const loginSuccess = (): TLoginSuccessAction => ({\r\n  type: LoginActionTypes.LOGIN_SUCCESS,\r\n});\r\n\r\n// loginError\r\nexport const loginError = (): TLoginErrorAction => ({\r\n  type: LoginActionTypes.LOGIN_ERROR,\r\n});\r\n\r\n// loginReset\r\nexport const loginReset = (): TLoginResetAction => ({\r\n  type: LoginActionTypes.LOGIN_RESET,\r\n});\r\n\r\n// loginThunk - THEN-CATCH variant\r\nexport function loginThunk(loginData: TLoginValues) {\r\n  return (\r\n    // all types of actions inside\r\n    dispatch: Dispatch<\r\n      | TLoginActions\r\n      | TSetAlertMessageAction\r\n      | TSetScreenAction\r\n      | TSaveUserDataAction\r\n    >,\r\n  ) => {\r\n    // loading\r\n    dispatch(loginLoading(true));\r\n\r\n    loginService\r\n      // LOGIN REQUEST\r\n      .logIn(loginData)\r\n\r\n      // ========= LOGIN SUCCESS ========= //\r\n      .then(res => {\r\n        dispatch(loginSuccess());\r\n\r\n        // save userData to store\r\n        dispatch(saveUserData(res.data));\r\n\r\n        // save userData to localStorage\r\n        localStorage.setItem(\r\n          'pickup-points-userdata',\r\n          JSON.stringify(res.data),\r\n        );\r\n\r\n        // save userData to cookies\r\n        Cookies.set('pickup-points-userdata', JSON.stringify(res.data));\r\n\r\n        // success alert\r\n        dispatch(\r\n          setAlertMessage({\r\n            message: `Login success`,\r\n            status: Statuses.success,\r\n          }),\r\n        );\r\n\r\n        // redirect after 1500\r\n        setTimeout(() => {\r\n          dispatch(loginLoading(false));\r\n          dispatch(setScreen(AppScreens.DASHBOARD));\r\n        }, 1500);\r\n      })\r\n\r\n      // ========= LOGIN ERROR ========= //\r\n      .catch(error => {\r\n        dispatch(loginError());\r\n        dispatch(loginLoading(false));\r\n\r\n        // error alert\r\n        dispatch(\r\n          setAlertMessage({ message: `${error}`, status: Statuses.danger }),\r\n        );\r\n      });\r\n  };\r\n}\r\n\r\n// loginThunk2 - ASYNC-AWAIT variant\r\nexport function loginThunk2(loginData: TLoginValues) {\r\n  return async (\r\n    dispatch: Dispatch<\r\n      | TLoginActions\r\n      | TSetAlertMessageAction\r\n      | TSetScreenAction\r\n      | TSaveUserDataAction\r\n    >,\r\n  ) => {\r\n    dispatch(loginLoading(true));\r\n\r\n    // login reauest\r\n    const response = await loginService.logIn(loginData);\r\n\r\n    // ========= LOGIN SUCCESS ========= //\r\n    if (response.status === 200) {\r\n      const responseSuccessData = response.data;\r\n\r\n      // save userData to store\r\n      dispatch(saveUserData(responseSuccessData));\r\n\r\n      // save userData to localStorage\r\n      localStorage.setItem(\r\n        'pickup-points-userdata',\r\n        JSON.stringify(responseSuccessData),\r\n      );\r\n\r\n      // save userData to cookies\r\n      Cookies.set(\r\n        'pickup-points-userdata',\r\n        JSON.stringify(responseSuccessData),\r\n      );\r\n\r\n      // success alert\r\n      dispatch(\r\n        setAlertMessage({\r\n          message: `Login success`,\r\n          status: Statuses.success,\r\n        }),\r\n      );\r\n\r\n      // redirect after 1500\r\n      setTimeout(() => {\r\n        dispatch(loginLoading(false));\r\n        dispatch(setScreen(AppScreens.DASHBOARD));\r\n      }, 1500);\r\n\r\n      // ========= LOGIN ERROR ========= //\r\n    } else {\r\n      dispatch(loginError());\r\n      dispatch(loginLoading(false));\r\n\r\n      // error alert\r\n      dispatch(\r\n        setAlertMessage({ message: `${response}`, status: Statuses.danger }),\r\n      );\r\n\r\n      // error data\r\n      // const responseErrorData = response.response.data;\r\n    }\r\n  };\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"httpclient",children:"httpClient"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { API_URL } from './apiUrl';\r\nimport axios from 'axios';\r\nimport { testStore } from '../store-redux-classic';\r\n\r\nconst httpClient = axios.create({\r\n  baseURL: API_URL,\r\n\r\n  headers: {\r\n    // inject userToken --\x3e get token value from store\r\n    Authorization: testStore.getState().app.userData.token,\r\n  },\r\n});\r\n\r\nexport default httpClient;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"loginservice",children:"../loginService"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { AxiosResponse } from 'axios';\r\nimport httpClient from '../httpClient';\r\n\r\nexport type TLoginValues = {\r\n  username: string;\r\n  password: string;\r\n};\r\n\r\n// THEN-CATCH variant\r\nexport const loginService = {\r\n  // logIn\r\n  logIn(loginValues: TLoginValues): Promise<AxiosResponse> {\r\n    const { username, password } = loginValues;\r\n\r\n    return (\r\n      httpClient\r\n        .post(`auth/login`, { username, password })\r\n\r\n        // login success\r\n        .then(res => {\r\n          // do smth\r\n        })\r\n\r\n        // logIn error\r\n        .catch(error => error)\r\n    );\r\n  },\r\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"how-to-use-inside-component",children:"How to use inside component"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"// import store hooks\r\nimport { useActions } from '../../../store-redux-classic/actions';\r\nimport { useTypedSelector } from '../../../store-redux-classic';\r\n\r\n...\r\n\r\nconst { isLoginLoading } = useTypedSelector(state => state.login);\r\nconst { loginThunk } = useActions();\r\n\r\n...\r\n\r\nonSubmit: (values: TLoginFormValues) => {\r\n  const { username, password } = values;\r\n\r\n  loginThunk2({ username, password });\r\n\r\n},\n"})})]})}function d(r={}){const{wrapper:n}={...(0,o.R)(),...r.components};return n?(0,s.jsx)(n,{...r,children:(0,s.jsx)(l,{...r})}):l(r)}},8453(r,n,e){e.d(n,{R:()=>a,x:()=>i});var t=e(6540);const s={},o=t.createContext(s);function a(r){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof r?r(n):{...n,...r}},[n,r])}function i(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(s):r.components||s:a(r.components),t.createElement(o.Provider,{value:n},r.children)}}}]);