"use strict";(globalThis.webpackChunkknowledge_bank=globalThis.webpackChunkknowledge_bank||[]).push([[4234],{2125(e,r,t){t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"frontend/react/archive/redux/slices","title":"\u0421\u043b\u0430\u0439\u0441\u044b","description":"\u0421\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 slice","source":"@site/docs/3 - frontend/5 - react/88-archive/2-redux/2-slices.md","sourceDirName":"3 - frontend/5 - react/88-archive/2-redux","slug":"/frontend/react/archive/redux/slices","permalink":"/knowledge-bank/docs/frontend/react/archive/redux/slices","draft":false,"unlisted":false,"editUrl":"https://github.com/EvgenyLeukhin/knowledge-bank/edit/main/docs/3 - frontend/5 - react/88-archive/2-redux/2-slices.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"\u0421\u043b\u0430\u0439\u0441\u044b","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Store \u0438 provider","permalink":"/knowledge-bank/docs/frontend/react/archive/redux/provider"},"next":{"title":"Thunks","permalink":"/knowledge-bank/docs/frontend/react/archive/redux/thunks"}}');var a=t(4848),s=t(8453);const o={title:"\u0421\u043b\u0430\u0439\u0441\u044b",sidebar_position:2},i=void 0,c={},l=[{value:"\u0421\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 slice",id:"\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439-slice",level:2},{value:"\u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 slice (createApi)",id:"\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439-slice-createapi",level:2},{value:"\u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u043b\u0430\u0439\u0441\u0430 \u0441 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u043c\u0438 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u043c\u0438 \u044d\u043a\u0448\u0435\u043d\u0430\u043c\u0438",id:"\u043f\u0440\u0438\u043c\u0435\u0440-\u0441\u043b\u0430\u0439\u0441\u0430-\u0441-\u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u043c\u0438-\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u043c\u0438-\u044d\u043a\u0448\u0435\u043d\u0430\u043c\u0438",level:2}];function d(e){const r={code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.h2,{id:"\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439-slice",children:"\u0421\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 slice"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\ntype TState = {\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  errorMessage: boolean;\r\n  data: TDataItem[];\r\n};\r\n\r\n// initialState\r\nconst initialState: TState = {\r\n  isLoading: false,\r\n  isSuccess: false,\r\n  errorMessage: false,\r\n  data: [],\r\n};\r\n\r\n// someSlice\r\nconst someSlice = createSlice({\r\n  name: 'some-slice',\r\n  initialState,\r\n  reducers: {\r\n    // setLoading - \u043f\u043e\u043b\u043d\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c\r\n    setLoading: (state, { payload }: PayloadAction<boolean>) => {\r\n      return {\r\n        ...state,\r\n        isLoading: payload,\r\n      };\r\n    },\r\n\r\n    // setLoading - \u043a\u043e\u0440\u043e\u0442\u043a\u0430\u044f \u0437\u0430\u043f\u0438\u0441\u044c (\u0432 RTK state \u043c\u0443\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u044b\u0439)\r\n    setLoading(state, { payload }: PayloadAction<boolean>) {\r\n      state.isLoading = payload;\r\n    },\r\n\r\n    // setSuccess\r\n    setSuccess(state, { payload }: PayloadAction<boolean>) {\r\n      state.isLoading = payload;\r\n    },\r\n\r\n    // resetErrorMessage\r\n    resetErrorMessage(state) {\r\n      state.errorMessage = initialState.isError;\r\n    },\r\n\r\n    // setData\r\n    setData(state, { payload }: PayloadAction<TDataItem[]>) {\r\n      state.data = payload;\r\n    },\r\n  },\r\n});\r\n\r\n// imports\r\nexport const someReducer = someSlice.reducer;\r\nexport const { setLoading, setSuccess, resetErrorMessage, setData } =\r\n  someSlice.actions;\n"})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439-slice-createapi",children:"\u0410\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 slice (createApi)"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\r\nimport { IProduct } from './api.types';\r\n\r\nexport const api = createApi({\r\n  // uniq key\r\n  reducerPath: 'api',\r\n\r\n  // api url RTK Query\r\n  baseQuery: fetchBaseQuery({ baseUrl: 'https://fakestoreapi.com' }),\r\n\r\n  // \u0432\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u0437\u0434\u0435\u0441\u044c\r\n  endpoints: builder => ({\r\n    // number for limit\r\n    getProducts: builder.query<IProduct[], number>({\r\n      query: (limit = 5) => `products?limit=${limit}`, // endpoint {baseUrl}/products\r\n    }),\r\n\r\n    // getPosts: builder.query({\r\n    //   query: () => '/posts',\r\n    // }),\r\n\r\n    // other request any params\r\n    // getPokemonByName: builder.query<IPokemon, string>({\r\n    //   query: name => `pokemon/${name}`,\r\n    // }),\r\n\r\n    // addNewPost: builder.mutation({\r\n    //   query: (payload) => ({\r\n    //     url: '/posts',\r\n    //     method: 'POST',\r\n    //     body: payload,\r\n    //     headers: {\r\n    //       'Content-type': 'application/json; charset=UTF-8',\r\n    //     },\r\n    //   }),\r\n    //   // invalidatesTags: ['Post'],\r\n    // }),\r\n  }),\r\n});\r\n\r\n// \u043c\u0430\u0433\u0438\u044f toolkit (\u0430\u0432\u0442\u043e\u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f)  \u0445\u0443\u043a, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0432\u0441\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b\r\nexport const {\r\n  useGetProductsQuery, // data, isLoading, isError - \u0445\u0443\u043a \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\r\n  // useGetPokemonByNameQuery,\r\n} = api;\n"})}),"\n",(0,a.jsx)(r.p,{children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0445\u0443\u043a\u0430 \u0438\u0437 createApi"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-tsx",children:"import { useGetProductsQuery } from '@/store/redux-toolkit/api/api';\r\n\r\n...\r\n\r\nconst { data, isLoading } = useGetProductsQuery(5);\n"})}),"\n",(0,a.jsx)(r.hr,{}),"\n",(0,a.jsx)(r.h2,{id:"\u043f\u0440\u0438\u043c\u0435\u0440-\u0441\u043b\u0430\u0439\u0441\u0430-\u0441-\u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u043c\u0438-\u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u043c\u0438-\u044d\u043a\u0448\u0435\u043d\u0430\u043c\u0438",children:"\u041f\u0440\u0438\u043c\u0435\u0440 \u0441\u043b\u0430\u0439\u0441\u0430 \u0441 \u0432\u0441\u0442\u0440\u043e\u0435\u043d\u043d\u044b\u043c\u0438 \u0430\u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u043c\u0438 \u044d\u043a\u0448\u0435\u043d\u0430\u043c\u0438"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-ts",children:"// src/store/ordersSearch/ordersSearchSlice.ts copy\r\nimport { toast } from 'react-toastify';\r\nimport { RootState } from '@store/index';\r\nimport { PayloadAction, createAsyncThunk, createSlice } from '@reduxjs/toolkit';\r\nimport { defaultNetworkErrorMsg } from '@constants/errorMessages';\r\n\r\n// getNotificationTemplates request\r\nimport {\r\n  INotificationTemplatesArgs,\r\n  INotificationTemplatesResponse,\r\n  getNotificationTemplates,\r\n} from '@api/methods/getNotificationTemplates';\r\nimport {\r\n  EMPTY_RESULT_DISPLAY_MESSAGE,\r\n  NOTIFICATION_TEMPLATES_INITIAL_STATE,\r\n} from './consts';\r\nimport { INotificationTemplate } from './types';\r\n\r\n// get template list\r\nexport const fetchNotificationTemplates = createAsyncThunk<\r\n  INotificationTemplatesResponse,\r\n  INotificationTemplatesArgs,\r\n  { rejectValue: string }\r\n>(\r\n  'notificationTemplates/fetchTemplates',\r\n  async (args, { getState, requestId, rejectWithValue }) => {\r\n    const { currentRequestId, isLoading } = (getState() as RootState)\r\n      .notificationTemplates;\r\n\r\n    if (!isLoading || requestId !== currentRequestId) {\r\n      return rejectWithValue('\u0417\u0430\u043f\u0440\u043e\u0441 \u0443\u0436\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f');\r\n    }\r\n\r\n    const result: INotificationTemplatesResponse =\r\n      await getNotificationTemplates(args);\r\n\r\n    if (!result.ok) {\r\n      toast.error(\r\n        `\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u0448\u0430\u0431\u043b\u043e\u043d\u043e\u0432 \u043d\u043e\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0439 ${result.error?.validation}`,\r\n      );\r\n      return rejectWithValue(\r\n        result.error?.message_code ||\r\n          '\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u0448\u0430\u0431\u043b\u043e\u043d\u043e\u0432 \u043d\u043e\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0439',\r\n      );\r\n    }\r\n    return result;\r\n  },\r\n);\r\n\r\nexport const notificationTemplatesSlice = createSlice({\r\n  name: 'notificationTemplates',\r\n  initialState: NOTIFICATION_TEMPLATES_INITIAL_STATE,\r\n\r\n  // \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0435 \u044d\u043a\u0448\u0435\u043d\u044b\r\n  reducers: {\r\n    setLoading(state, { payload }: PayloadAction<boolean>) {\r\n      state.isLoading = payload;\r\n    },\r\n    setError(state, { payload }: PayloadAction<string>) {\r\n      state.error = payload;\r\n    },\r\n\r\n    // set templates\r\n    setTemplates(state, { payload }: PayloadAction<INotificationTemplate[]>) {\r\n      state.templates = payload;\r\n    },\r\n\r\n    // select template\r\n    setSelectedTemplate(\r\n      state,\r\n      { payload }: PayloadAction<INotificationTemplate | null>,\r\n    ) {\r\n      state.selectedTemplate = payload;\r\n    },\r\n\r\n    // search string\r\n    setSearchString(state, { payload }: PayloadAction<string>) {\r\n      state.searchString = payload;\r\n    },\r\n\r\n    // search string\r\n    setSearchSuggestions(state, { payload }: PayloadAction<string[]>) {\r\n      state.searchSuggestions = payload;\r\n    },\r\n  },\r\n\r\n  extraReducers: builder => {\r\n    // fetchNotificationTemplates - isLoading\r\n    builder.addCase(fetchNotificationTemplates.pending, (state, { meta }) => {\r\n      return {\r\n        ...state,\r\n        currentRequestId: meta.requestId,\r\n        isLoading: true,\r\n        error: null,\r\n        emptyResultDisplayMessage: null,\r\n      };\r\n    }),\r\n      // fetchNotificationTemplates - isSuccess\r\n      builder.addCase(\r\n        fetchNotificationTemplates.fulfilled,\r\n        (state, { payload, meta }) => {\r\n          if (meta.requestId !== state.currentRequestId) return state;\r\n\r\n          return {\r\n            ...state,\r\n            currentRequestId: null,\r\n            isLoading: false,\r\n            error: null,\r\n            templates: payload.data?.notification_template || [],\r\n            emptyResultDisplayMessage: !payload.data?.notification_template\r\n              .length\r\n              ? EMPTY_RESULT_DISPLAY_MESSAGE\r\n              : null,\r\n          };\r\n        },\r\n      ),\r\n      // fetchNotificationTemplates - isError\r\n      builder.addCase(\r\n        fetchNotificationTemplates.rejected,\r\n        (state, { payload, error }) => {\r\n          return {\r\n            ...state,\r\n            currentRequestId: null,\r\n            isLoading: false,\r\n            error: payload || error.message || defaultNetworkErrorMsg,\r\n          };\r\n        },\r\n      );\r\n  },\r\n});\r\n\r\n// export actions\r\nconst {\r\n  setLoading,\r\n  setError,\r\n  setTemplates,\r\n  setSelectedTemplate,\r\n  setSearchString,\r\n  setSearchSuggestions,\r\n} = notificationTemplatesSlice.actions;\r\nexport {\r\n  setLoading,\r\n  setError,\r\n  setTemplates,\r\n  setSelectedTemplate,\r\n  setSearchString,\r\n  setSearchSuggestions,\r\n};\r\n\r\n// export reducer\r\nexport default notificationTemplatesSlice.reducer;\n"})})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,r,t){t.d(r,{R:()=>o,x:()=>i});var n=t(6540);const a={},s=n.createContext(a);function o(e){const r=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);